=head1 NAME Cantella::JobQueue::Store - Store API definition and documentation

=head1 NOTICE

This is experimental software. APIs and implementation details  may be subject
to change.

=head1 DESCRIPTION

This document is a description of the API requirements for Cantella::JobQueue
stores.

=head1 REQUIRED METHODS

The following methods must be implemented by stores with identical APIs

=head2 store_job

=over 4

=item Arguments: C<$job_object>

=item Return Value: C<$job_id>

=back

Given a L<Cantella::JobQueue::Job> object, it will store the object for later
retrieval and return an id that can be used to retrieve it. The storage id may
be of any type and may be provided as part of the job object or automatically
generated by the store.

=head2 get_job

=over 4

=item Arguments: C<$job_id>

=item Return Value: C<$job_object>

=back

Will retrieve a L<Cantella::JobQueue::Job> object using the given C<$job_id>.
Will return undef in scalar context and an empty list in list context if the
job can not be found.

=head2 delete_job

=over 4

=item Arguments: none

=item Return Value: none

=back

Delete a job from the store. An exception should be thrown in case of an error,
if a job does not exist or if the job is locked.

=head2 complete_job

=over 4

=item Arguments: C<$job_id>, C<$completed_successfully>

=item Return Value: C<$success>

=back

Mark a job as completed. C<$completed_successfully> should be a boolean value.
Will return 1 on success. If a job has already been marked as complete or does
not exist an exception may be thrown. If the job is locked, then the lock will
be released after the job is marked as complete.

=head2 lock_job

=over 4

=item Arguments: C<$job_id>, C<DateTime $until>

=item Return Value: C<$success>

=back

Attempt to gain a lock on a job. Will return true if the lock was granted, zero
if the job is already locked, and throw an exception if the job is not located
or has already been completed.

=head2 unlock_job

=over 4

=item Arguments: C<$job_id>

=item Return Value: none

=back

Unlock a job. If a job is not locked or does not exist  an exception should
be thrown.

=head2 clear_expired_locks

=over 4

=item Arguments: none

=item Return Value: none

=back

Clear any expired job locks.

=head2 log_job_error

=over 4

=item Arguments: C<$job_id>, C<$error_message>

=item Return Value: none

=back

Log an error associated with C<$job_id>

=head2 get_job_errors

=over 4

=item Arguments: C<$job_id>

=item Return Value: C<\ @error_messages>

=back

Returns an array reference with all of the error messages for this job in the
order in which they were logged. If the job does not exist an exception should
be thrown.

=head2 get_completed_jobs

=over 4

=item Arguments: none

=item Return Value: C<\ @job_objects>

=back

Returns a list of jobs that have been completed. The order of the items in this
list is at the discretion of the store.

=head2 get_available_jobs

=over 4

=item Arguments: none

=item Return Value: C<\ @job_objects>

=back

Will return an array reference containing zero or more available jobs. The list
of jobs returned need not be the complete list of available jobs or be in any
particular order.

=head2 get_available_jobs_by_type

=over 4

=item Arguments: C<\ @job_types>

=item Return Value: C<\ @job_objects>

=back

Will return an array reference containing zero or more available jobs which are
of the given types. The list of jobs returned need not be the complete list of
available jobs or be in any particular order. If C<\ @job_types> is empty, then
an empty list will be returned.


=head2 get_job_by_type

=over 4

=item Arguments: C<$job_type>

=item Return Value: C<\ @job_objects>

=back

Will return an array reference containing all available jobs

=head1 AUTHOR

Guillermo Roditi (groditi) E<lt>groditi@cpan.orgE<gt>

=cut
